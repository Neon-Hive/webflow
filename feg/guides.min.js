document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("mapClose"),t=document.getElementById("mapOpen"),l=document.getElementById("mapEnlarge"),i=document.getElementById("mapShrink");let s=document.querySelector(".guide_main-layout"),a=document.querySelector(".guide_map"),n=[document.querySelector(".guide_map-wrap"),document.querySelector(".guide_body-wrap")];function o(e,t,l){if(Array.isArray(e)&&e.length){let n=new Map(e.map(e=>[e,e.getBoundingClientRect()])),o=(t?.(),new Map(e.map(e=>[e,e.getBoundingClientRect()])));e.forEach(e=>{var t=n.get(e),l=o.get(e),i=t.left-l.left,s=t.top-l.top,a=t.width/l.width,t=t.height/l.height;e.style.willChange="transform",e.style.transformOrigin="top left",e.style.transform=`translate(${i}px, ${s}px) scale(${a}, ${t})`}),requestAnimationFrame(()=>{e.forEach(e=>{e.style.transition="transform 500ms cubic-bezier(.2,.8,.2,1)",e.style.transform="none"});e[0].addEventListener("transitionend",()=>{e.forEach(e=>{e.style.transition="",e.style.transform="",e.style.willChange=""}),l?.()},{once:!0})})}else t?.(),l?.()}let r=!1,d=!1,c=!1,m=e=>{c||(c=!0,e?.())};l?.addEventListener("click",()=>{d?m(()=>{o(n,()=>{s.classList.remove("is-closed"),n.forEach(e=>e.classList.add("is-enlarged"))},()=>{s.classList.add("is-enlarged"),d=!1,r=!0,c=!1})}):r||d||m(()=>{o(n,()=>{n.forEach(e=>e.classList.add("is-enlarged"))},()=>{s.classList.add("is-enlarged"),r=!0,c=!1})})}),i?.addEventListener("click",()=>{r&&m(()=>{s.classList.remove("is-enlarged"),o(n,()=>{n.forEach(e=>e.classList.remove("is-enlarged"))},()=>{r=!1,c=!1})})}),e?.addEventListener("click",()=>{r?m(()=>{o(n,()=>{s.classList.remove("is-enlarged"),n.forEach(e=>e.classList.remove("is-enlarged")),s.classList.add("is-closed"),a.classList.remove("enlarged"),a.classList.add("sticky")},()=>{r=!1,d=!0,c=!1})}):d||m(()=>{o(n,()=>{s.classList.add("is-closed"),a.classList.remove("enlarged"),a.classList.add("sticky")},()=>{d=!0,c=!1})})}),t?.addEventListener("click",()=>{d&&!r&&m(()=>{o(n,()=>{s.classList.remove("is-closed")},()=>{d=!1,c=!1})})});let u=document.querySelector("#guideMobileFilters");l=document.querySelector("#guideMobileFilterToggle");let y=document.querySelectorAll(".guide_filters-mobile-wrapper .filters_toggle_icon_wrap .filters_toggle_icon"),te=l.querySelectorAll(".filters_toggle_text"),le=!1;function ie(){le=!1,u.classList.remove("is-open-map","is-open-list"),2<=y.length&&(y[0].classList.remove("is2"),y[1].classList.add("is2"))}l.addEventListener("click",()=>{le?ie():(le=!0,r?u.classList.add("is-open-map"):u.classList.add("is-open-list"),2<=y.length&&(y[0].classList.add("is2"),y[1].classList.remove("is2")))}),document.querySelectorAll("[data-gallery='main']").forEach(e=>{if(e){let t=e.querySelector("[data-gallery='main-image']"),l=e.querySelectorAll("[data-gallery='thumbnail']");1<l.length&&(l[0].classList.add("is-active"),e=l[0].querySelector("img"),t.src=e.src,l.forEach(e=>{e.addEventListener("click",()=>{l.forEach(e=>e.classList.remove("is-active")),t.src=e.querySelector("img").src,e.classList.add("is-active")})})),1===l.length&&(e=l[0].querySelector("img"),l[0].style.display="none",t.src=e.src)}}),(async(F="guide-map")=>{var{}=await google.maps.importLibrary("maps"),{}=await google.maps.importLibrary("marker"),N=document.getElementById(F);let H=document.querySelector(".guide_map-enlarge-view");var e=document.querySelector("#mapModule");let t=document.getElementById("mapNext"),l=document.getElementById("mapPrev"),s=e.querySelector("[data-map-module='image']"),a=e.querySelector("[data-map-module='title']"),n=e.querySelector("[data-map-module='link']"),o=document.querySelector('[data-map-module="container"]'),r=e.querySelector("[data-map-module='price']"),d=e.querySelector("[data-map-module='access']"),c=e.querySelector("[data-map-module='course']"),m=e.querySelector("[data-map-module='stay']"),u=e.querySelector("[data-map-module='eat']"),y=0,g=[];function P(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function p(){return mapItems.filter(e=>{e=T[e.slug];return e&&e.getVisible()})}function V(){g=p(),(y=0)<g.length&&S(g[0]),w()}function $(){if(g=p(),(y=0)<g.length){var t=g[0];if(t){if(s&&(s.src=t.image||"",s.alt=t.name||""),a&&(a.textContent=P(t.name||"")),"Course"===t.type?(c.style.display="flex",m.style.display="none",u.style.display="none"):"Stay"===t.type?(m.style.display="flex",c.style.display="none",u.style.display="none"):"Eat"===t.type&&(u.style.display="flex",c.style.display="none",m.style.display="none"),n){let e=!1;"Course"===t.type?(n.href="/courses/"+t.slug,e=!0):t.link&&""!==t.link.trim()&&(n.href=t.link,e=!0),e?(n.style.display="",n.style.visibility="visible"):(n.style.display="none",n.style.visibility="hidden")}var e="Course"===t.type&&t.price&&""!==t.price.trim(),l=(r&&(e?(r.textContent=t.price,r.style.display="",r.style.visibility="visible"):(r.style.display="none",r.style.visibility="hidden")),"Course"===t.type&&t.access&&""!==t.access.trim());d&&(l?(d.textContent=t.access,d.style.display="",d.style.visibility="visible"):(d.style.display="none",d.style.visibility="hidden")),e||l?(o.style.display="",o.style.visibility="visible"):(o.style.display="none",o.style.visibility="hidden"),console.log("Map module updated (without panning) for: "+t.slug)}}w()}let i=document.querySelector(".guide_map");var e=document.getElementById("mapEnlarge"),v=document.getElementById("mapShrink");let f=document.getElementById("mapVector"),h=document.getElementById("mapSatellite");var L=document.getElementById("mapZoomIn"),b=document.getElementById("mapZoomOut");let E=!1;function S(t){if(t){if(s&&(s.src=t.image||"",s.alt=t.name||""),a&&(a.textContent=P(t.name||"")),"Course"===t.type?(c.style.display="flex",m.style.display="none",u.style.display="none"):"Stay"===t.type?(m.style.display="flex",c.style.display="none",u.style.display="none"):"Eat"===t.type&&(u.style.display="flex",c.style.display="none",m.style.display="none"),n){let e=!1;"Course"===t.type?(n.href="/courses/"+t.slug,e=!0):t.link&&""!==t.link.trim()&&(n.href=t.link,e=!0),e?(n.style.display="",n.style.visibility="visible"):(n.style.display="none",n.style.visibility="hidden")}var l="Course"===t.type&&t.price&&""!==t.price.trim(),i=(r&&(l?(r.textContent=t.price,r.style.display="",r.style.visibility="visible"):(r.style.display="none",r.style.visibility="hidden")),"Course"===t.type&&t.access&&""!==t.access.trim());d&&(i?(d.textContent=t.access,d.style.display="",d.style.visibility="visible"):(d.style.display="none",d.style.visibility="hidden")),l&&i?(o.style.display="",o.style.visibility="visible"):(o.style.display="none",o.style.visibility="hidden");let e=T[t.slug];e&&(Q((l=e.getPosition()).lat(),l.lng(),13,800),Object.values(T).forEach(e=>e.setAnimation(null)),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==e.getAnimation()&&e.setAnimation(null)},1e3)),console.log("Map module updated for: "+t.slug)}}function j(){0!==g.length&&(y=(y+1)%g.length,S(g[y]),w())}function R(){0!==g.length&&(y=0===y?g.length-1:y-1,S(g[y]),w())}function w(){t&&l&&(g.length<=1?(t.style.display="none",l.style.display="none"):(t.style.display="flex",l.style.display="flex"),l.classList.toggle("disabled",0===y),t.classList.toggle("disabled",y===g.length-1))}e.addEventListener("click",()=>{E||(i.classList.remove("sticky"),i.classList.add("enlarged"),V()),E=!E}),v.addEventListener("click",()=>{E&&(i.classList.add("sticky"),i.classList.remove("enlarged")),E=!E}),f.addEventListener("click",()=>{f.classList.add("is-active"),h.classList.remove("is-active"),_.setMapTypeId("roadmap")}),h.addEventListener("click",()=>{f.classList.remove("is-active"),h.classList.add("is-active"),_.setMapTypeId("satellite")}),L.addEventListener("click",()=>{_.setZoom(_.getZoom()+1)}),b.addEventListener("click",()=>{_.setZoom(_.getZoom()-1)});let q=document.querySelector("#guideMobileList"),C=document.querySelector("#guideMobileMap"),D=document.querySelector(".guide_map-wrap"),U=document.querySelector(".guide_body-items-append"),z=(q.addEventListener("click",()=>{q.classList.add("is-active"),C.classList.remove("is-active"),U.classList.remove("u-hide"),H.classList.add("u-hide"),D.style.display="none",E=!E}),C.addEventListener("click",()=>{C.classList.add("is-active"),q.classList.remove("is-active"),U.classList.add("u-hide"),H.classList.remove("u-hide"),D.style.display="block",V(),E=!E}),t&&t.addEventListener("click",j),l&&l.addEventListener("click",R),"all");function W(t){var l,i;console.log("Applying map filter: "+t),z=t,l=t,o=document.querySelectorAll("[data-filter]"),l&&te.forEach(e=>{e.innerHTML=`Filter: <span class="is-active">${l}</span>`}),o.forEach(e=>{var t=e.dataset.filter;e.classList.remove("is-active"),t===l&&e.classList.add("is-active")}),i=t,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{var t=e.dataset.type;"all"===i||t===i?(e.style.display="",e.classList.remove("filtered-out")):(e.style.display="none",e.classList.add("filtered-out"))});{var a=t;let i=[],s=new google.maps.LatLngBounds;if(Object.entries(T).forEach(([t,e])=>{var l=mapItems.find(e=>e.slug===t);l&&("all"===a||l.type===a?(e.setMap(_),e.setVisible(!0),i.push(e),s.extend(e.getPosition())):(e.setMap(null),e.setVisible(!1)))}),0<i.length){if(1===i.length){var n=i[0].getPosition();_.setCenter({lat:n.lat(),lng:n.lng()}),_.setZoom(14)}else if(!s.isEmpty()){var n=s.getNorthEast(),o=s.getSouthWest(),t=(n.lat()+o.lat())/2,r=(n.lng()+o.lng())/2,d=n.lat()-o.lat(),n=n.lng()-o.lng(),o=Math.max(d+.001*d,n+.001*n);let e=14;e=.1<o?11:.05<o?12:.02<o?13:.01<o?14:.005<o?15:16,_.setCenter({lat:t,lng:r}),_.setZoom(e)}}else _.setCenter({lat:-33.8419,lng:151.0834}),_.setZoom(10)}Z=null,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),E&&$()}document.querySelectorAll("[data-filter]").forEach(e=>{e.addEventListener("click",()=>{W(e.dataset.filter),le&&ie()})}),document.addEventListener("keydown",e=>{E&&("ArrowRight"===e.key||"ArrowDown"===e.key?(e.preventDefault(),j()):"ArrowLeft"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),R()))});let A=document.querySelectorAll("[data-guide-header-image]"),k=document.querySelector("[data-guide-header-progress]"),Y=k.querySelector(".guide_progress"),x=(Y.remove(),A.forEach(()=>{var e=Y.cloneNode(!0);e.classList.remove("u-hide"),k.appendChild(e)}),k.querySelectorAll(".guide_progress-bar")),M=0;function G(){A.forEach((e,t)=>{e.classList.remove("is-active"),x[t].style.transition="none",x[t].style.width="0%"}),A[M].classList.add("is-active"),setTimeout(()=>{x[M].style.transition="width 10s linear",x[M].style.width="100%"},50),M=(M+1)%A.length}setInterval(G,1e4),G(),e=document.querySelectorAll("[data-guide-item='true']"),v=document.querySelector("[data-guide-ordering]");let I=document.querySelector("[data-guide-append]"),B=v.textContent.match(/{{(.*?)}}/g).map(e=>e.replace(/{{|}}/g,"").trim()),_=(L=Array.from(e),b=L.filter(e=>!B.includes(e.dataset.slug)),(v=L.filter(e=>B.includes(e.dataset.slug))).sort((e,t)=>{e=e.dataset.slug,t=t.dataset.slug;return B.indexOf(e)-B.indexOf(t)}),I.innerHTML="",v.forEach(e=>{I.appendChild(e)}),b.forEach(e=>{I.appendChild(e)}),(e=document.querySelector(".guide_loading-skeletons"))&&e.remove(),L={mapId:"c0e1c832f5f11b41ba746cf8",zoom:10,center:{lat:-33.8419,lng:151.0834},gestureHandling:window.innerWidth<=425?"greedy":"auto",disableDefaultUI:!0,zoomControl:!1,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1,rotateControl:!1,scaleControl:!1},console.log("Initialising the map:",F),new google.maps.Map(N,L)),J=(window.map=_,{Eat:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb596bbb24ca62e18b198_eat-icon.svg"},Stay:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb59629bee07dae592c97_stay-icon.svg"},Course:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb596353ab56c0e69d870_play-icon.svg"}}),T={},O=(mapItems.forEach(a=>{if(a.lat&&a.lng){let i={lat:Number.parseFloat(a.lat),lng:Number.parseFloat(a.lng)},s=new google.maps.Marker({position:i,map:_,icon:J[a.type]||null,title:a.type});s.addListener("click",()=>{var t,e,l;Z=a.slug,t=a.slug,(e=mapItems.find(e=>e.slug===t))&&E&&(g=p(),-1===(y=g.findIndex(e=>e.slug===t))&&(y=0),S(e),w()),e=a.slug,(l=document.querySelector(`[data-guide-item='true'][data-slug='${e}']`))&&"none"!==l.style.display&&!l.classList.contains("filtered-out")&&(document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),l.classList.add("map-active"),l=l.getBoundingClientRect(),l=(window.pageYOffset||document.documentElement.scrollTop)+l.top-100,window.scrollTo({top:l,behavior:"smooth"}),console.log("Scrolled to content item: "+e)),Q(i.lat,i.lng,15,800),Object.values(T).forEach(e=>e.setAnimation(null)),s.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==s.getAnimation()&&s.setAnimation(null)},1e3)}),T[a.slug]=s,console.log(`Added marker for type: ${a.type} at`,i)}}),null),Z=null;function K(){var l=Object.values(T).filter(e=>e.getVisible());if(0===l.length)_.setCenter({lat:-33.8419,lng:151.0834}),_.setZoom(10);else if(1===l.length)i=l[0].getPosition(),_.setCenter({lat:i.lat(),lng:i.lng()}),_.setZoom(14);else{let t=new google.maps.LatLngBounds;if(l.forEach(e=>{t.extend(e.getPosition())}),!t.isEmpty()){var i=t.getNorthEast(),l=t.getSouthWest(),s=(i.lat()+l.lat())/2,a=(i.lng()+l.lng())/2,n=i.lat()-l.lat(),i=i.lng()-l.lng(),l=Math.max(n+.001*n,i+.001*i);let e=14;e=.1<l?11:.05<l?12:.02<l?13:.01<l?14:.005<l?15:16,_.setCenter({lat:s,lng:a}),_.setZoom(e)}console.log("Fitted all visible markers for initial view")}}function Q(e,t,l,a=800){O&&cancelAnimationFrame(O);let n=performance.now();var i=_.getCenter();let o=_.getZoom(),r=i.lat(),d=i.lng(),c=e-r,m=t-d,u=l-o;O=requestAnimationFrame(function e(t){var t=t-n,t=Math.min(t/a,1),l=(l=t)<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,i=r+c*l,s=d+m*l,l=o+u*l;_.setCenter({lat:i,lng:s}),_.setZoom(l),O=t<1?requestAnimationFrame(e):null})}function X(e,t=.5){var e=e.getBoundingClientRect(),l=window.innerHeight,i=Math.max(0,e.top),l=Math.min(l,e.bottom);return t<=Math.max(0,l-i)/e.height}function ee(){var t=(()=>{var e=document.querySelectorAll("[data-guide-item='true']:not(.filtered-out)");let l=window.innerHeight/2,i=null,s=-1;return e.forEach(e=>{var t;X(e,.3)&&"none"!==e.style.display&&(t=(t=e.getBoundingClientRect()).top+t.height/2,(t=.7*(X(e,0)?1:0)+.3*(1-Math.abs(t-l)/(window.innerHeight/2)))>s)&&(s=t,i=e)}),i})();if(t){var l,i,s=t.dataset.slug;if(s&&s!==Z){Z=s;let e=T[s];e&&e.getVisible()&&(l=(i=e.getPosition()).lat(),i=i.lng(),document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),t.classList.add("map-active"),Q(l,i,14,600),Object.values(T).forEach(e=>e.setAnimation(null)),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==e.getAnimation()&&e.setAnimation(null)},750),console.log("Map focused on: "+s))}}else null!==Z&&(console.log("No item in focus, fitting all visible markers"),Z=null,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),Object.values(T).forEach(e=>e.setAnimation(null)),K())}v=((t,l)=>{let i;return function(){var e=arguments;i||(t.apply(this,e),i=!0,setTimeout(()=>i=!1,l))}})(ee,100),window.addEventListener("scroll",v),window.addEventListener("resize",((t,l)=>{let i;return function(...e){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t(...e)},l)}})(ee,250)),setTimeout(()=>{W("all"),K()},500)})()});