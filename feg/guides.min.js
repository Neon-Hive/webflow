document.addEventListener("DOMContentLoaded",()=>{var e=document.getElementById("mapClose"),t=document.getElementById("mapOpen"),l=document.getElementById("mapEnlarge"),i=document.getElementById("mapShrink");let s=document.querySelector(".guide_main-layout"),a=document.querySelector(".guide_map"),n=[document.querySelector(".guide_map-wrap"),document.querySelector(".guide_body-wrap")];function o(e,t,l){if(Array.isArray(e)&&e.length){let n=new Map(e.map(e=>[e,e.getBoundingClientRect()])),o=(t?.(),new Map(e.map(e=>[e,e.getBoundingClientRect()])));e.forEach(e=>{var t=n.get(e),l=o.get(e),i=t.left-l.left,s=t.top-l.top,a=t.width/l.width,t=t.height/l.height;e.style.willChange="transform",e.style.transformOrigin="top left",e.style.transform=`translate(${i}px, ${s}px) scale(${a}, ${t})`}),requestAnimationFrame(()=>{e.forEach(e=>{e.style.transition="transform 500ms cubic-bezier(.2,.8,.2,1)",e.style.transform="none"});e[0].addEventListener("transitionend",()=>{e.forEach(e=>{e.style.transition="",e.style.transform="",e.style.willChange=""}),l?.()},{once:!0})})}else t?.(),l?.()}let r=!1,d=!1,c=!1,u=e=>{c||(c=!0,e?.())};l?.addEventListener("click",()=>{d?u(()=>{o(n,()=>{s.classList.remove("is-closed"),n.forEach(e=>e.classList.add("is-enlarged"))},()=>{s.classList.add("is-enlarged"),d=!1,r=!0,c=!1})}):r||d||u(()=>{o(n,()=>{n.forEach(e=>e.classList.add("is-enlarged"))},()=>{s.classList.add("is-enlarged"),r=!0,c=!1})})}),i?.addEventListener("click",()=>{r&&u(()=>{s.classList.remove("is-enlarged"),o(n,()=>{n.forEach(e=>e.classList.remove("is-enlarged"))},()=>{r=!1,c=!1})})}),e?.addEventListener("click",()=>{r?u(()=>{o(n,()=>{s.classList.remove("is-enlarged"),n.forEach(e=>e.classList.remove("is-enlarged")),s.classList.add("is-closed"),a.classList.remove("enlarged"),a.classList.add("sticky")},()=>{r=!1,d=!0,c=!1})}):d||u(()=>{o(n,()=>{s.classList.add("is-closed"),a.classList.remove("enlarged"),a.classList.add("sticky")},()=>{d=!0,c=!1})})}),t?.addEventListener("click",()=>{d&&!r&&u(()=>{o(n,()=>{s.classList.remove("is-closed")},()=>{d=!1,c=!1})})});let m=document.querySelector("#guideMobileFilters");l=document.querySelector("#guideMobileFilterToggle");let y=document.querySelectorAll(".guide_filters-mobile-wrapper .filters_toggle_icon_wrap .filters_toggle_icon"),J=l.querySelectorAll(".filters_toggle_text"),g=document.querySelector(".guide_map-enlarge-view"),p=document.querySelector("#guideMobileList"),v=document.querySelector("#guideMobileMap"),f=document.querySelector(".guide_map-wrap"),h=document.querySelector(".guide_body-items-append"),K=(p.addEventListener("click",()=>{p.classList.add("is-active"),v.classList.remove("is-active"),h.classList.remove("u-hide"),g.classList.add("u-hide"),f.style.display="none",r=!1}),v.addEventListener("click",()=>{v.classList.add("is-active"),p.classList.remove("is-active"),h.classList.add("u-hide"),g.classList.remove("u-hide"),f.style.display="block",r=!0}),!1);function Q(){K=!1,m.classList.remove("is-open-map","is-open-list"),2<=y.length&&(y[0].classList.remove("is2"),y[1].classList.add("is2"))}l.addEventListener("click",()=>{console.log("mobie filter toggle clicked"),K?Q():(K=!0,r?(console.log("map enlarged"),m.classList.add("is-open-map")):m.classList.add("is-open-list"),2<=y.length&&(y[0].classList.add("is2"),y[1].classList.remove("is2")))}),document.querySelectorAll("[data-gallery='main']").forEach(e=>{if(e){let t=e.querySelector("[data-gallery='main-image']"),l=e.querySelectorAll("[data-gallery='thumbnail']");1<l.length&&(l[0].classList.add("is-active"),e=l[0].querySelector("img"),t.src=e.src,l.forEach(e=>{e.addEventListener("click",()=>{l.forEach(e=>e.classList.remove("is-active")),t.src=e.querySelector("img").src,e.classList.add("is-active")})})),1===l.length&&(e=l[0].querySelector("img"),l[0].style.display="none",t.src=e.src)}}),(async(e="guide-map")=>{var{}=await google.maps.importLibrary("maps"),{}=await google.maps.importLibrary("marker"),F=document.getElementById(e),t=(document.querySelector(".guide_map-enlarge-view"),document.querySelector("#mapModule"));let l=document.getElementById("mapNext"),i=document.getElementById("mapPrev"),s=t.querySelector("[data-map-module='image']"),a=t.querySelector("[data-map-module='title']"),n=t.querySelector("[data-map-module='link']"),o=document.querySelector('[data-map-module="container"]'),r=t.querySelector("[data-map-module='price']"),d=t.querySelector("[data-map-module='access']"),c=t.querySelector("[data-map-module='course']"),u=t.querySelector("[data-map-module='stay']"),m=t.querySelector("[data-map-module='eat']"),y=0,g=[];function N(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function p(){return mapItems.filter(e=>{e=_[e.slug];return e&&e.getVisible()})}function R(){g=p(),(y=0)<g.length&&w(g[0]),q()}function H(){if(g=p(),(y=0)<g.length){var t=g[0];if(t){if(s&&(s.src=t.image||"",s.alt=t.name||""),a&&(a.textContent=N(t.name||"")),"Course"===t.type?(c.style.display="flex",u.style.display="none",m.style.display="none"):"Stay"===t.type?(u.style.display="flex",c.style.display="none",m.style.display="none"):"Eat"===t.type&&(m.style.display="flex",c.style.display="none",u.style.display="none"),n){let e=!1;"Course"===t.type?(n.href="/courses/"+t.slug,e=!0):t.link&&""!==t.link.trim()&&(n.href=t.link,e=!0),e?(n.style.display="",n.style.visibility="visible"):(n.style.display="none",n.style.visibility="hidden")}var e="Course"===t.type&&t.price&&""!==t.price.trim(),l=(r&&(e?(r.textContent=t.price,r.style.display="",r.style.visibility="visible"):(r.style.display="none",r.style.visibility="hidden")),"Course"===t.type&&t.access&&""!==t.access.trim());d&&(l?(d.textContent=t.access,d.style.display="",d.style.visibility="visible"):(d.style.display="none",d.style.visibility="hidden")),e||l?(o.style.display="",o.style.visibility="visible"):(o.style.display="none",o.style.visibility="hidden"),console.log("Map module updated (without panning) for: "+t.slug)}}q()}let v=document.querySelector(".guide_map");var t=document.getElementById("mapEnlarge"),f=document.getElementById("mapShrink");let h=document.getElementById("mapVector"),L=document.getElementById("mapSatellite");var b=document.getElementById("mapZoomIn"),E=document.getElementById("mapZoomOut");let S=!1;function w(t){if(t){if(s&&(s.src=t.image||"",s.alt=t.name||""),a&&(a.textContent=N(t.name||"")),"Course"===t.type?(c.style.display="flex",u.style.display="none",m.style.display="none"):"Stay"===t.type?(u.style.display="flex",c.style.display="none",m.style.display="none"):"Eat"===t.type&&(m.style.display="flex",c.style.display="none",u.style.display="none"),n){let e=!1;"Course"===t.type?t.courseRef&&""!==t.courseRef.trim()&&(n.href="/courses/"+t.slug,e=!0):t.link&&""!==t.link.trim()&&(n.href=t.link,e=!0),e?(n.style.display="",n.style.visibility="visible"):(n.style.display="none",n.style.visibility="hidden")}var l="Course"===t.type&&t.price&&""!==t.price.trim(),i=(r&&(l?(r.textContent=t.price,r.style.display="",r.style.visibility="visible"):(r.style.display="none",r.style.visibility="hidden")),"Course"===t.type&&t.access&&""!==t.access.trim());d&&(i?(d.textContent=t.access,d.style.display="",d.style.visibility="visible"):(d.style.display="none",d.style.visibility="hidden")),l&&i?(o.style.display="",o.style.visibility="visible"):(o.style.display="none",o.style.visibility="hidden");let e=_[t.slug];e&&(Z((l=e.getPosition()).lat(),l.lng(),13,800),Object.values(_).forEach(e=>e.setAnimation(null)),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==e.getAnimation()&&e.setAnimation(null)},1e3)),console.log("Map module updated for: "+t.slug)}}function P(){0!==g.length&&(y=(y+1)%g.length,w(g[y]),q())}function V(){0!==g.length&&(y=0===y?g.length-1:y-1,w(g[y]),q())}function q(){l&&i&&(g.length<=1?(l.style.display="none",i.style.display="none"):(l.style.display="flex",i.style.display="flex"),i.classList.toggle("disabled",0===y),l.classList.toggle("disabled",y===g.length-1))}t.addEventListener("click",()=>{S||(v.classList.remove("sticky"),v.classList.add("enlarged"),R()),S=!S}),f.addEventListener("click",()=>{S&&(v.classList.add("sticky"),v.classList.remove("enlarged")),S=!S}),h.addEventListener("click",()=>{h.classList.add("is-active"),L.classList.remove("is-active"),B.setMapTypeId("roadmap")}),L.addEventListener("click",()=>{h.classList.remove("is-active"),L.classList.add("is-active"),B.setMapTypeId("satellite")}),b.addEventListener("click",()=>{B.setZoom(B.getZoom()+1)}),E.addEventListener("click",()=>{B.setZoom(B.getZoom()-1)}),t=document.querySelector("#guideMobileList"),f=document.querySelector("#guideMobileMap"),t.addEventListener("click",()=>{S=!1}),f.addEventListener("click",()=>{S=!0,R()}),l&&l.addEventListener("click",P),i&&i.addEventListener("click",V);let $="all";function j(t){var l,i;console.log("Applying map filter: "+t),$=t,l=t,o=document.querySelectorAll("[data-filter]"),l&&J.forEach(e=>{e.innerHTML=`Filter: <span class="is-active">${l}</span>`}),o.forEach(e=>{var t=e.dataset.filter;e.classList.remove("is-active"),t===l&&e.classList.add("is-active")}),i=t,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{var t=e.dataset.type;"all"===i||t===i?(e.style.display="",e.classList.remove("filtered-out")):(e.style.display="none",e.classList.add("filtered-out"))});{var a=t;let i=[],s=new google.maps.LatLngBounds;if(Object.entries(_).forEach(([t,e])=>{var l=mapItems.find(e=>e.slug===t);l&&("all"===a||l.type===a?(e.setMap(B),e.setVisible(!0),i.push(e),s.extend(e.getPosition())):(e.setMap(null),e.setVisible(!1)))}),0<i.length){if(1===i.length){var n=i[0].getPosition();B.setCenter({lat:n.lat(),lng:n.lng()}),B.setZoom(14)}else if(!s.isEmpty()){var n=s.getNorthEast(),o=s.getSouthWest(),t=(n.lat()+o.lat())/2,r=(n.lng()+o.lng())/2,d=n.lat()-o.lat(),n=n.lng()-o.lng(),o=Math.max(d+.001*d,n+.001*n);let e=14;e=.1<o?11:.05<o?12:.02<o?13:.01<o?14:.005<o?15:16,B.setCenter({lat:t,lng:r}),B.setZoom(e)}}else B.setCenter({lat:-33.8419,lng:151.0834}),B.setZoom(10)}O=null,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),S&&H()}document.querySelectorAll("[data-filter]").forEach(e=>{e.addEventListener("click",()=>{j(e.dataset.filter),K&&Q()})}),document.addEventListener("keydown",e=>{S&&("ArrowRight"===e.key||"ArrowDown"===e.key?(e.preventDefault(),P()):"ArrowLeft"!==e.key&&"ArrowUp"!==e.key||(e.preventDefault(),V()))});let k=document.querySelectorAll("[data-guide-header-image]"),C=document.querySelector("[data-guide-header-progress]"),D=C.querySelector(".guide_progress"),A=(D.remove(),k.forEach(()=>{var e=D.cloneNode(!0);e.classList.remove("u-hide"),C.appendChild(e)}),C.querySelectorAll(".guide_progress-bar")),M=0;function U(){k.forEach((e,t)=>{e.classList.remove("is-active"),A[t].style.transition="none",A[t].style.width="0%"}),k[M].classList.add("is-active"),setTimeout(()=>{A[M].style.transition="width 10s linear",A[M].style.width="100%"},50),M=(M+1)%k.length}setInterval(U,1e4),U(),b=document.querySelectorAll("[data-guide-item='true']"),E=document.querySelector("[data-guide-ordering]");let x=document.querySelector("[data-guide-append]"),I=E.textContent.match(/{{(.*?)}}/g).map(e=>e.replace(/{{|}}/g,"").trim()),B=(t=Array.from(b),f=t.filter(e=>!I.includes(e.dataset.slug)),(E=t.filter(e=>I.includes(e.dataset.slug))).sort((e,t)=>{e=e.dataset.slug,t=t.dataset.slug;return I.indexOf(e)-I.indexOf(t)}),x.innerHTML="",E.forEach(e=>{x.appendChild(e)}),f.forEach(e=>{x.appendChild(e)}),(b=document.querySelector(".guide_loading-skeletons"))&&b.remove(),t={mapId:"c0e1c832f5f11b41ba746cf8",zoom:10,center:{lat:-33.8419,lng:151.0834},gestureHandling:window.innerWidth<=425?"greedy":"auto",disableDefaultUI:!0,zoomControl:!1,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1,rotateControl:!1,scaleControl:!1},console.log("Initialising the map:",e),new google.maps.Map(F,t)),z=(window.map=B,{Eat:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb596bbb24ca62e18b198_eat-icon.svg"},Stay:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb59629bee07dae592c97_stay-icon.svg"},Course:{url:"https://cdn.prod.website-files.com/67ab6ef769ff843db623d6f5/689eb596353ab56c0e69d870_play-icon.svg"}}),_={},T=(mapItems.forEach(a=>{if(a.lat&&a.lng){let i={lat:Number.parseFloat(a.lat),lng:Number.parseFloat(a.lng)},s=new google.maps.Marker({position:i,map:B,icon:z[a.type]||null,title:a.type});s.addListener("click",()=>{var t,e,l;O=a.slug,t=a.slug,(e=mapItems.find(e=>e.slug===t))&&S&&(g=p(),-1===(y=g.findIndex(e=>e.slug===t))&&(y=0),w(e),q()),e=a.slug,(l=document.querySelector(`[data-guide-item='true'][data-slug='${e}']`))&&"none"!==l.style.display&&!l.classList.contains("filtered-out")&&(document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),l.classList.add("map-active"),l=l.getBoundingClientRect(),l=(window.pageYOffset||document.documentElement.scrollTop)+l.top-100,window.scrollTo({top:l,behavior:"smooth"}),console.log("Scrolled to content item: "+e)),Z(i.lat,i.lng,15,800),Object.values(_).forEach(e=>e.setAnimation(null)),s.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==s.getAnimation()&&s.setAnimation(null)},1e3)}),_[a.slug]=s,console.log(`Added marker for type: ${a.type} at`,i)}}),null),O=null;function W(){var l=Object.values(_).filter(e=>e.getVisible());if(0===l.length)B.setCenter({lat:-33.8419,lng:151.0834}),B.setZoom(10);else if(1===l.length)i=l[0].getPosition(),B.setCenter({lat:i.lat(),lng:i.lng()}),B.setZoom(14);else{let t=new google.maps.LatLngBounds;if(l.forEach(e=>{t.extend(e.getPosition())}),!t.isEmpty()){var i=t.getNorthEast(),l=t.getSouthWest(),s=(i.lat()+l.lat())/2,a=(i.lng()+l.lng())/2,n=i.lat()-l.lat(),i=i.lng()-l.lng(),l=Math.max(n+.001*n,i+.001*i);let e=14;e=.1<l?11:.05<l?12:.02<l?13:.01<l?14:.005<l?15:16,B.setCenter({lat:s,lng:a}),B.setZoom(e)}console.log("Fitted all visible markers for initial view")}}function Z(e,t,l,a=800){T&&cancelAnimationFrame(T);let n=performance.now();var i=B.getCenter();let o=B.getZoom(),r=i.lat(),d=i.lng(),c=e-r,u=t-d,m=l-o;T=requestAnimationFrame(function e(t){var t=t-n,t=Math.min(t/a,1),l=(l=t)<.5?4*l*l*l:1-Math.pow(-2*l+2,3)/2,i=r+c*l,s=d+u*l,l=o+m*l;B.setCenter({lat:i,lng:s}),B.setZoom(l),T=t<1?requestAnimationFrame(e):null})}function Y(e,t=.5){var e=e.getBoundingClientRect(),l=window.innerHeight,i=Math.max(0,e.top),l=Math.min(l,e.bottom);return t<=Math.max(0,l-i)/e.height}function G(){var t=(()=>{var e=document.querySelectorAll("[data-guide-item='true']:not(.filtered-out)");let l=window.innerHeight/2,i=null,s=-1;return e.forEach(e=>{var t;Y(e,.3)&&"none"!==e.style.display&&(t=(t=e.getBoundingClientRect()).top+t.height/2,(t=.7*(Y(e,0)?1:0)+.3*(1-Math.abs(t-l)/(window.innerHeight/2)))>s)&&(s=t,i=e)}),i})();if(t){var l,i,s=t.dataset.slug;if(s&&s!==O){O=s;let e=_[s];e&&e.getVisible()&&(l=(i=e.getPosition()).lat(),i=i.lng(),document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),t.classList.add("map-active"),Z(l,i,14,600),Object.values(_).forEach(e=>e.setAnimation(null)),e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(()=>{null!==e.getAnimation()&&e.setAnimation(null)},750),console.log("Map focused on: "+s))}}else null!==O&&(console.log("No item in focus, fitting all visible markers"),O=null,document.querySelectorAll("[data-guide-item='true']").forEach(e=>{e.classList.remove("map-active")}),Object.values(_).forEach(e=>e.setAnimation(null)),W())}E=((t,l)=>{let i;return function(){var e=arguments;i||(t.apply(this,e),i=!0,setTimeout(()=>i=!1,l))}})(G,100),window.addEventListener("scroll",E),window.addEventListener("resize",((t,l)=>{let i;return function(...e){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),t(...e)},l)}})(G,250)),setTimeout(()=>{j("all"),W()},500)})()});