class VideoLibrary{constructor(e={}){this.options={rootMargin:e.rootMargin||"100px",threshold:e.threshold||0,scrollTriggerThreshold:e.scrollTriggerThreshold||.5,debug:e.debug||!1,...e},this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.videoObserver=null,this.scrollObservers=new Map,this.pictureElementCache=new WeakMap,this.eventListeners=new WeakMap,this.resizeHandler=null,this.resizeTimeout=null,this.init()}init(){0!==document.querySelectorAll("video[data-video]").length&&(this.prefersReducedMotion&&console.log("User prefers reduced motion. Videos will not auto-play."),this.removeDesktopOnlyVideos(),this.setupLazyLoading(),this.setupVideoControls(),this.setupHoverPlay(),0<document.querySelectorAll('video[data-video-desktop-only="true"]').length)&&(this.resizeHandler=()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.removeDesktopOnlyVideos()},150)},window.addEventListener("resize",this.resizeHandler))}getComponentContainer(e){return e.closest('[data-video="component"]')||e.parentElement||null}removeDesktopOnlyVideos(){var e=document.querySelectorAll('video[data-video-desktop-only="true"]');let i=window.innerWidth<=991;e.forEach(e=>{var t=this.getComponentContainer(e),t=t?t.querySelector('[data-video-playback="wrapper"]'):null;i?(e.style.display="none",this.showPictureElement(e),t&&(t.style.display="none",t.style.visibility="hidden",t.setAttribute("aria-hidden","true"))):(e.style.display="",this.hidePictureElement(e),t&&(t.style.display="",t.style.visibility="",t.setAttribute("aria-hidden","false")))})}setupLazyLoading(){var e,t=document.querySelectorAll("video[data-video]");0!==t.length&&(e={root:null,rootMargin:this.options.rootMargin,threshold:this.options.threshold},this.videoObserver=new IntersectionObserver((e,i)=>{e.forEach(t=>{if(t.isIntersecting){let e=t.target;this.lazyLoadVideo(e).then(()=>i.unobserve(e)).catch(console.error)}})},e),t.forEach(e=>{var t="true"===e.getAttribute("data-video-scroll-in-play"),i="true"===e.getAttribute("data-video-hover");this.videoObserver.observe(e),i&&t?this.setupScrollInPlayForHover(e):i||(this.prefersReducedMotion?e.pause():t?this.setupScrollInPlay(e):this.setupAutoplay(e))}))}lazyLoadVideo(o){return new Promise((t,i)=>{let r=o.querySelector("source[data-src]");r&&!r.src?(r.src=r.getAttribute("data-src"),o.load(),o.addEventListener("canplaythrough",function e(){o.removeEventListener("canplaythrough",e),t()}),o.addEventListener("error",function e(){o.removeEventListener("error",e),i(new Error("Error loading video: "+r.src))})):t()})}showPictureElement(e){e=this.findPictureElement(e);e&&(e.style.display="block")}hidePictureElement(e){e=this.findPictureElement(e);e&&(e.style.display="none")}findPictureElement(e){if(this.pictureElementCache.has(e))return this.pictureElementCache.get(e);let t=null,i=e.previousElementSibling;for(;i;){if("PICTURE"===i.tagName||"IMG"===i.tagName){t=i;break}i=i.previousElementSibling}var r;return t||(r=this.getComponentContainer(e))&&(t=r.querySelector("picture, img")),this.pictureElementCache.set(e,t),t}setupVideoControls(){document.querySelectorAll("video[data-video]").forEach(e=>{this.handlePlaybackButtons(e)})}setupHoverPlay(){document.querySelectorAll('video[data-video-hover="true"]').forEach(e=>{var t,i=this.getComponentContainer(e),r=i||e;let o=!1;r&&(this.showPictureElement(e),i&&(i=i.querySelector('[data-video-playback="button"]'))&&(i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex","-1")),i=()=>{e.pause()},r.addEventListener("mouseenter",t=async()=>{if(!this.prefersReducedMotion)try{this.hidePictureElement(e),await this.lazyLoadVideo(e),o||(e.currentTime=0,o=!0),e.play()}catch(e){console.error("Error playing hover video:",e)}}),r.addEventListener("mouseleave",i),this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push({element:r,type:"mouseenter",handler:t},{element:r,type:"mouseleave",handler:i}))})}setupAutoplay(e){e.addEventListener("canplaythrough",()=>{this.prefersReducedMotion||(this.hidePictureElement(e),e.play().catch(console.error))})}setupScrollInPlay(i){let r=!1;var e=new IntersectionObserver(e=>{for(var t of e)t.isIntersecting?this.lazyLoadVideo(i).then(()=>{this.prefersReducedMotion||(this.hidePictureElement(i),r||(i.currentTime=0,r=!0),i.play())}).catch(console.error):i.pause()},{threshold:this.options.scrollTriggerThreshold});e.observe(i),this.scrollObservers.set(i,e)}setupScrollInPlayForHover(i){var e=new IntersectionObserver(e=>{for(var t of e)t.isIntersecting&&this.lazyLoadVideo(i).then(()=>{i.pause(),this.showPictureElement(i)}).catch(console.error)},{threshold:this.options.scrollTriggerThreshold});e.observe(i),this.scrollObservers.set(i,e)}handlePlaybackButtons(s){var e=this.getComponentContainer(s);if(e){let o=e.querySelector('[data-video-playback="button"]');if(o){let i=o.querySelector('[data-video-playback="play"]'),r=o.querySelector('[data-video-playback="pause"]');if(i&&r){let t=e=>{e?(i.style.display="none",i.style.visibility="hidden",i.setAttribute("aria-hidden","true"),r.style.display="flex",r.style.visibility="visible",r.setAttribute("aria-hidden","false"),o.setAttribute("aria-label","Pause video")):(i.style.display="flex",i.style.visibility="visible",i.setAttribute("aria-hidden","false"),r.style.display="none",r.style.visibility="hidden",r.setAttribute("aria-hidden","true"),o.setAttribute("aria-label","Play video"))};t(!s.paused);var e=async e=>{if(e.stopPropagation(),s.paused)try{await this.lazyLoadVideo(s),this.hidePictureElement(s),s.play(),t(!0)}catch(e){console.error(e)}else s.pause(),t(!1)},n=()=>t(!0),a=()=>t(!1);o.addEventListener("click",e),s.addEventListener("play",n),s.addEventListener("pause",a),this.eventListeners.has(s)||this.eventListeners.set(s,[]),this.eventListeners.get(s).push({element:o,type:"click",handler:e},{element:s,type:"play",handler:n},{element:s,type:"pause",handler:a})}}}}async playVideo(t){var e=document.querySelector(`video[data-video="${t}"]`);if(e)try{await this.lazyLoadVideo(e),this.prefersReducedMotion||(this.hidePictureElement(e),e.currentTime=0,e.play())}catch(e){console.error(`Error playing video ${t}:`,e)}else console.warn(`Video with id "${t}" not found`)}pauseVideo(e){var t=document.querySelector(`video[data-video="${e}"]`);t?t.pause():console.warn(`Video with id "${e}" not found`)}pauseAllVideos(){document.querySelectorAll("video[data-video]").forEach(e=>{e.pause()})}destroy(){this.videoObserver&&this.videoObserver.disconnect(),this.scrollObservers.forEach(e=>{e.disconnect()}),this.scrollObservers.clear(),this.eventListeners.forEach(e=>{e.forEach(({element:e,type:t,handler:i})=>{e.removeEventListener(t,i)})}),this.eventListeners=new WeakMap,this.resizeHandler&&(window.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.pictureElementCache=new WeakMap}reinitialize(){this.destroy(),this.init()}}function initializeVideoLibrary(){0<document.querySelectorAll("video[data-video]").length?window.videoLibrary=new VideoLibrary:window.VideoLibraryConfig?.debug&&console.log("VideoLibrary: No videos detected, skipping auto-initialization.")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeVideoLibrary):initializeVideoLibrary(),"undefined"!=typeof module&&module.exports&&(module.exports=VideoLibrary);