async function loadGoogleMapsAPI(){if(!window.google||!google.maps||!google.maps.Geocoder)return new Promise((e,o)=>{if(window.google&&google.maps&&google.maps.Geocoder)return e();var t=document.createElement("script");t.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0jAOIGrgm3Lds1w4emxDtTADvgtYUFYo&libraries=places",t.async=!0,t.defer=!0,t.onload=()=>{console.log("✅ Google Maps API Loaded"),e()},t.onerror=()=>o(new Error("❌ Google Maps API failed to load")),document.head.appendChild(t)})}async function geocodeAddress(e){if(await loadGoogleMapsAPI(),google.maps.Geocoder)return new Promise((t,n)=>{(new google.maps.Geocoder).geocode({address:e},(e,o)=>{"OK"===o&&0<e.length?t(e[0]):n(new Error("Geocoding failed: "+o))})});throw new Error("Google Maps Geocoder is not available.")}async function fetchAutocomplete(e){return(await fetch("https://places.googleapis.com/v1/places:autocomplete",{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":"AIzaSyB0jAOIGrgm3Lds1w4emxDtTADvgtYUFYo","X-Goog-FieldMask":"suggestions(placePrediction(place,placeId,text))"},body:JSON.stringify({input:e,includedRegionCodes:["US","CA"]})})).json()}function debounce(o,t){let n;return function(...e){clearTimeout(n),n=setTimeout(()=>o.apply(this,e),t)}}function displaySuggestions(e){let t=document.getElementById("autocomplete-results"),n=document.querySelector(".g_location_form_input_wrap");t||((t=document.createElement("div")).id="autocomplete-results",t.style.position="absolute",t.style.top="3.5rem",t.style.background="#fff",t.style.border="1px solid #eee",t.style.width="100%",t.style.maxHeight="300px",t.style.overflowY="auto",t.style.zIndex="1000",(document.querySelector(".g_location_form")||document.body).appendChild(t)),t.innerHTML="",0<e.length?n.classList.add("input-no-round"):(n.classList.remove("input-no-round"),t.remove()),e.forEach(e=>{if(e.placePrediction){let o=e.placePrediction;e=document.createElement("div");e.textContent=o.text.text,e.style.padding="8px",e.style.cursor="pointer",e.style.borderBottom="1px solid #eee",e.addEventListener("click",()=>{var e=document.getElementById("geo-address");e&&(e.value=o.text.text,e.dataset.placeId=o.placeId),t.innerHTML="",t.remove(),n.classList.remove("input-no-round"),hideError(),updateFindButtonState()}),t.appendChild(e)}})}function updateFindButtonState(){var e=document.getElementById("geo-address"),o=document.getElementById("find-btn");e&&o&&(""===e.value.trim()?(o.style.opacity="0.5",o.style.pointerEvents="none"):(o.style.opacity="1",o.style.pointerEvents="auto"))}async function getAddressFromCoordinates(e,o){try{return(await loadGoogleMapsAPI(),google.maps.Geocoder)?new Promise((t,n)=>{(new google.maps.Geocoder).geocode({location:{lat:e,lng:o}},(e,o)=>{"OK"===o&&0<e.length?(e=e[0].formatted_address,console.log("✅ Address from Coordinates:",e),t(e)):(console.error("❌ No address found or geocoding failed:",o),n("Unable to retrieve address."))})}):(console.error("❌ Google Maps Geocoder is not available."),null)}catch(e){return console.error("❌ Error in getAddressFromCoordinates:",e),null}}async function getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(async e=>{var o=e.coords.latitude,e=e.coords.longitude;console.log("📍 User's Location:",o,e);try{var t,n=await getAddressFromCoordinates(o,e);n?(t=document.getElementById("geo-address"))&&(t.value=n,t.dataset.lat=o,t.dataset.lng=e,updateFindButtonState()):showError("❌ Unable to retrieve address from your location.")}catch(e){console.error("❌ Error fetching address:",e),showError("❌ Unable to retrieve address from your location.")}},e=>{console.error("❌ Geolocation error:",e),showError("❌ Unable to get your location. Please enable location services.")}):showError("❌ Geolocation is not supported by your browser.")}function initNewAutocomplete(){let t=document.getElementById("geo-address");t&&t.addEventListener("input",debounce(async function(){var e=t.value.trim();if(e)try{var o=await fetchAutocomplete(e);o.suggestions&&displaySuggestions(o.suggestions)}catch(e){console.error("Autocomplete error:",e)}else(e=document.getElementById("autocomplete-results"))&&(e.innerHTML="")},300))}function showError(e){var o=document.getElementById("address-error");o&&(o.textContent=e,o.style.display="block")}function hideError(){var e=document.getElementById("address-error");e&&(e.style.display="none",e.textContent="")}document.getElementById("find-btn").addEventListener("click",async t=>{t.preventDefault();var t=document.getElementById("geo-address").value.trim(),n=document.getElementById("find-btn"),r=n.querySelector(".btn_main_icon"),s=r.innerHTML;if(t){r.innerHTML='<div class="spinner"></div>',n.style.opacity="0.5",n.style.pointerEvents="none";let e,o;if(!e||!o)try{var a=await geocodeAddress(t);e=a.geometry.location.lat(),o=a.geometry.location.lng()}catch(e){return console.error("Geocoding error:",e),showError("The address entered is not valid. Please select a valid address from the suggestions."),r.innerHTML=s,n.style.opacity="1",void(n.style.pointerEvents="auto")}t=`/locations?lat=${e}&lng=`+o;console.log("Redirecting to:",t),window.location.href=t}else console.error("No address entered."),showError("Please enter an address.")}),document.getElementById("get_location_btn").addEventListener("click",async e=>{e.preventDefault(),console.log("Getting user location..."),await getUserLocation()}),document.getElementById("geo-address").addEventListener("input",function(){var e=document.querySelector(".g_location_form_input_wrap");""===this.value.trim()&&(e.classList.remove("input-no-round"),document.getElementById("autocomplete-results").remove())}),document.addEventListener("DOMContentLoaded",()=>{updateFindButtonState();var e=document.getElementById("geo-address");e&&(hideError(),e.addEventListener("input",updateFindButtonState)),initNewAutocomplete()});