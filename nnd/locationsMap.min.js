function addItemsToLocationData(){document.querySelectorAll(".location_block_result_item_wrap").forEach(t=>{var o=t.getAttribute("data-name"),a=parseFloat(t.getAttribute("data-lat"))||0,n=parseFloat(t.getAttribute("data-lng"))||0;let i=o+`_${a}_`+n;if(!locationData.some(e=>e.uniqueKey===i)){let e=t.querySelector("img")?.getAttribute("src")||"";e&&""!==e.trim()&&"https://cdn.prod.website-files.com/plugins/Basic/assets/placeholder.60f9b1840c.svg"!==e||(e="https://cdn.prod.website-files.com/67ab6f4970b90367b528f15a/67aecfc6a895ff8fabea7a46_Staffing%20Support.webp"),locationData.push({uniqueKey:i,name:o,lat:a,lng:n,imageUrl:e,link:t.getAttribute("data-link")?"/location/"+t.getAttribute("data-link"):"",country:t.getAttribute("data-country")||"",state:t.getAttribute("data-state")||"",city:t.getAttribute("data-city")||"",postcodes:t.getAttribute("data-postcode")||"",stateISO:t.getAttribute("data-state-iso")||""})}}),window.dispatchEvent(new Event("locationDataLoaded"))}function syncStateAttributes(){let a=document.querySelectorAll("#w-dropdown-list-5 .filters_dropdown_list_item");var e=document.querySelectorAll(".cms-states .w-dyn-item[n4-filter-state-country]");let n=document.querySelectorAll("#area option");e.forEach(e=>{let t=e.querySelector("div").textContent.trim(),o=e.getAttribute("n4-filter-state-country");n.forEach(e=>{e.textContent.trim()===t&&e.setAttribute("n4-filter-state-country",o)}),a.forEach(e=>{e.textContent.trim()===t&&e.setAttribute("n4-filter-state-country",o)})})}window.fsAttributes=window.fsAttributes||[],window.locationData=window.locationData||[],window.fsAttributes.push(["cmsload",t=>{window.fsAttributes.cmsnest.init().then(()=>{console.log("CMS Nest successfully initialized!"),document.querySelectorAll(".locations_loading-wrapper").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".n4_loading-skeleton:not(.is-location-item)").forEach(e=>{e.style.display="none"}),document.querySelectorAll(".locations_nest").forEach(e=>{e.style.display=""}),syncStateAttributes();let[e]=t;window.fsAttributes.cmsfilter.init().then(()=>{console.log("CMS Filter successfully initialized!"),e.listInstance.on("renderitems",()=>{console.log("FinSweet Filtering Applied. Checking empty countries..."),checkForEmptyCountries()})}),console.log("CMS Nest loading complete.")}),t.forEach(e=>{e.on("loaded",()=>{addItemsToLocationData()})}),addItemsToLocationData()}]),document.addEventListener("DOMContentLoaded",function(){window.userLocation=null;var e=document.querySelectorAll(".locations_loading-wrapper");async function l(){if(!window.google||!google.maps||!google.maps.Geocoder)return new Promise((e,t)=>{if(window.google&&google.maps&&google.maps.Geocoder)return e();var o=document.createElement("script");o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0jAOIGrgm3Lds1w4emxDtTADvgtYUFYo&libraries=places",o.async=!0,o.defer=!0,o.onload=()=>{console.log("✅ Google Maps API Loaded"),e()},o.onerror=()=>t(new Error("❌ Google Maps API failed to load")),document.head.appendChild(o)})}async function c(e=!1){if(!navigator.geolocation)return r("❌ Geolocation is not supported by your browser."),null;try{var t=await navigator.permissions.query({name:"geolocation"});return"denied"===t.state?(console.warn("❌ Geolocation access denied."),alert("Location access is blocked. Please enable it in your browser settings."),null):"prompt"!==t.state||e?new Promise((i,e)=>{navigator.geolocation.getCurrentPosition(async e=>{var t=e.coords.latitude,e=e.coords.longitude;console.log("📍 User's Location:",t,e),s();try{var o,a,n=await(async(e,t)=>{try{return(await l(),google.maps.Geocoder)?new Promise((o,a)=>{(new google.maps.Geocoder).geocode({location:{lat:e,lng:t}},(e,t)=>{"OK"===t&&0<e.length?(e=e[0].formatted_address,console.log("✅ Address from Coordinates:",e),o(e)):(console.error("❌ No address found or geocoding failed:",t),a("Unable to retrieve address."))})}):(console.error("❌ Google Maps Geocoder is not available."),null)}catch(e){return console.error("❌ Error in getAddressFromCoordinates:",e),null}})(t,e);n?(o=document.getElementById("geo-address"))&&(o.value=n,o.dataset.lat=t,o.dataset.lng=e):r("❌ Unable to retrieve address from your location."),window.map&&(console.log("📌 Fitting map to user location"),a=new google.maps.LatLng(t,e),window.map.setCenter(a),window.map.setZoom(10)),window.userLocation={lat:t,lng:e},window.updateMarkersList(),i({lat:t,lng:e})}catch(e){console.error("❌ Error fetching address:",e),r("❌ Unable to retrieve address from your location."),i(null)}},e=>{console.error("❌ Geolocation error:",e),r("❌ Unable to get your location. Please enable location services."),i(null)})}):(console.log("⏳ Waiting for user to interact before requesting location."),null)}catch(e){return console.error("❌ Error checking geolocation permission:",e),null}}function r(e){var t=document.getElementById("address-error");t&&(t.textContent=e,t.style.display="block")}function s(){var e=document.getElementById("address-error");e&&(e.style.display="none",e.textContent="")}function d(e,t,o,a){var n=(o-e)*(Math.PI/180),a=Math.PI/180*(a-t),t=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*(Math.PI/180))*Math.cos(o*(Math.PI/180))*Math.sin(a/2)*Math.sin(a/2);return(6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))).toFixed(1)}function m(){if(window.map&&window.markers){var e,o=document.getElementById("map_result_count"),m=document.querySelector(".location_hero_list");let t=map.getBounds();t&&(e=markers.filter(e=>t.contains(e.getPosition())),m.innerHTML="",0<e.length?(window.userLocation?(e.forEach(e=>{e.extraData.distance=d(window.userLocation.lat,window.userLocation.lng,e.getPosition().lat(),e.getPosition().lng())}),e.sort((e,t)=>e.extraData.distance-t.extraData.distance)):e.sort((e,t)=>e.extraData.name.localeCompare(t.extraData.name)),e.forEach(e=>{var t,o,a,n,i,r,l,s,c,d;e.extraData?({name:t,link:o,imageUrl:a,distance:n,country:i,state:r,city:l,postcodes:s,stateISO:c}=e.extraData,(d=document.createElement("a")).classList.add("location_hero_item"),d.href=o,d.setAttribute("n4-filter-name",t?t.toLowerCase():""),d.setAttribute("n4-filter-city",l?l.toLowerCase():""),d.setAttribute("n4-filter-state",r?r.toLowerCase():""),d.setAttribute("n4-filter-country",i?i.toLowerCase():""),d.setAttribute("n4-filter-postcodes",s?s.toLowerCase():""),d.setAttribute("n4-filter-stateISO",c?c.toLowerCase():""),d.innerHTML=`
          <div class="location_hero_item_image_wrap">
            <img src="${a}" loading="lazy" alt="${t}" class="location_hero_item_image">
          </div>
          <div class="location_hero_item_content">
            <h4 class="location_hero_item_heading u-text-style-large">${t}, ${c}</h4>
            <div class="learnmore_wrap is-underline w-inline-block">
              <div class="learnmore_text u-text-style-main">See Location</div>
              <div class="learnmore_underline"></div>
              <div class="learnmore_icon w-embed">
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                  <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                  <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                </svg>
              </div>
            </a>
          </div>
        `,m.appendChild(d)):console.warn("❌ Missing extraData for marker:",e)}),o.textContent=`Showing ${e.length} Locations`):window.userLocation?(console.warn("No visible markers. Displaying the closest 3 locations."),window.markers.forEach(e=>{e.extraData.distance=d(window.userLocation.lat,window.userLocation.lng,e.getPosition().lat(),e.getPosition().lng())}),0<(e=window.markers.filter(e=>null!==e.extraData.distance&&!isNaN(e.extraData.distance)).sort((e,t)=>e.extraData.distance-t.extraData.distance).slice(0,3)).length?(e.forEach((e,t)=>{var{name:e,link:o,imageUrl:a,distance:n,stateISO:i}=e.extraData,r=document.createElement("a");r.classList.add("location_hero_item"),r.href=o,r.innerHTML=`
            <div class="location_hero_item_image_wrap">
              <img src="${a}" loading="lazy" alt="${e}" class="location_hero_item_image">
            </div>
            <div class="location_hero_item_content">
              <h4 class="location_hero_item_heading u-text-style-large">${e}, ${i}</h4>
              <p class="u-text-style-small">${n} km away from you</p>
              <div class="learnmore_wrap is-underline w-inline-block">
                <div class="learnmore_text u-text-style-main">See Location</div>
                <div class="learnmore_underline"></div>
                <div class="learnmore_icon w-embed">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                    <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                    <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                  </svg>
                </div>
              </a>
            </div>
          `,m.appendChild(r)}),o.textContent="Showing Closest Locations to your current location."):o.textContent="No locations found in this area."):(console.warn("No locations available in this area."),o.textContent="No locations found in this area."))}}function g(e){var i=document.querySelector(".location_hero_list");i.innerHTML="",e.forEach(e=>{var{name:e,link:t,imageUrl:o,stateISO:a}=e.extraData,n=document.createElement("a");n.classList.add("location_hero_item"),n.href=t,n.innerHTML=`
      <div class="location_hero_item_image_wrap">
        <img src="${o}" loading="lazy" alt="${e}" class="location_hero_item_image">
      </div>
      <div class="location_hero_item_content">
        <h4 class="location_hero_item_heading u-text-style-large">${e}, ${a}</h4>
        <div class="learnmore_wrap is-underline w-inline-block">
          <div class="learnmore_text u-text-style-main">See Location</div>
          <div class="learnmore_underline"></div>
          <div class="learnmore_icon w-embed">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
              <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
              <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
            </svg>
          </div>
        </a>
      </div>
    `,i.appendChild(n)}),document.getElementById("map_result_count").textContent=`Showing ${e.length} Locations`}async function t(e="map_canvas"){var{}=await google.maps.importLibrary("maps"),t=document.getElementById(e);let a=await c(),o={mapTypeId:"roadmap",zoom:12,gestureHandling:window.innerWidth<=425?"greedy":"auto",styles:[{featureType:"administrative",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"administrative.province",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-100},{lightness:"50"},{visibility:"simplified"}]},{featureType:"road",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]},{featureType:"water",elementType:"labels",stylers:[{lightness:-25},{saturation:-100}]}],disableDefaultUI:!0,zoomControl:!0,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!0,rotateControl:!1,scaleControl:!1};console.log("Initializing the map:",e);var l=new google.maps.Map(t,o);window.map=l;let n={url:"https://cdn.prod.website-files.com/67ab6f4970b90367b528f15a/67c8f176df8419775322fa3d_NND-marker.svg",scaledSize:new google.maps.Size(50,65),anchor:new google.maps.Point(25,60)},i=[],r=new google.maps.LatLngBounds,s=new google.maps.InfoWindow;locationData.forEach(e=>{let t=null,o=(a&&(t=d(a.lat,a.lng,e.lat,e.lng)),new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:l,icon:n}));o.extraData={name:e.name,link:e.link,imageUrl:e.imageUrl,distance:t,country:e.country,state:e.state,city:e.city,postcodes:e.postcodes||"",stateISO:e.stateISO},o.addListener("click",()=>{s.setContent(`
          <div style="max-width: 250px;">
            <div class="u-vflex-stretch-center u-gap-3">
              <div style="overflow: hidden; border-radius: .75rem;">
                <img style="max-height: 8rem; aspect-ratio: 16 / 9; object-position: 0% 50%;" src="${e.imageUrl}" alt="${e.name}">
              </div>
                <div>
                  <h4 class="location_hero_item_heading u-text-style-large">${e.name}, ${e.stateISO}</h4>
                  <p class="u-text-style-tiny">${e.city}, ${e.state}, ${e.country}</p>
                </div>
              ${t?`<p style="margin: 5px 0; font-size: 14px;"><strong>${t} km away</strong></p>`:""}
              <a href="${e.link}" class="learnmore_wrap is-underline w-inline-block">
                <div class="learnmore_text u-text-style-main">See Location</div>
                <div class="learnmore_underline"></div>
                <div class="learnmore_icon w-embed">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                    <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                    <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                  </svg>
                </div>
              </a>
            </div>
          </div>
        `),s.open(l,o)}),i.push(o),r.extend(o.getPosition())}),window.markers=i,console.log("Markers added successfully."),document.querySelectorAll(".n4_loading-skeleton").forEach(e=>{"none"!=e.style.display&&(e.style.display="none")}),document.querySelector(".location_hero_count_wrap").style.display="block",a?(console.log("✅ Centering on user location:",a),l.setCenter(a),l.setZoom(10)):0<i.length&&l.fitBounds(r),l.addListener("bounds_changed",m),setTimeout(m,1e3);new markerClusterer.MarkerClusterer({map:l,markers:i,renderer:{render:function({count:e,position:t}){var o=10*Math.floor(e/10),o=Math.min(40+o,80),a=o/2,n=a,i=a+.1*o,r=Math.floor(o/3),a={url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
        <svg width="${o}" height="${o}" xmlns="http://www.w3.org/2000/svg">
          <circle cx="${a}" cy="${a}" r="${a}" fill="#EC008C" />
          <text x="${n}" y="${i}" text-anchor="middle" fill="#fff" font-size="${r}" font-family="Arial" font-weight="bold">${e}</text>
        </svg>
        `),scaledSize:new google.maps.Size(o,o)};return new google.maps.Marker({map:l,position:t,icon:a})}},zoomOnClick:!1,onClusterClick:(e,t)=>{t=t.bounds;l.fitBounds(t),setTimeout(()=>{14<l.getZoom()&&l.setZoom(14)},300)}});return l}async function o(){var e=new URLSearchParams(window.location.search),t=parseFloat(e.get("lat")),e=parseFloat(e.get("lng"));if(isNaN(t)||isNaN(e)){if(window.map&&window.markers){let t=new google.maps.LatLngBounds;window.markers.forEach(e=>t.extend(e.getPosition())),window.map.fitBounds(t)}}else await new Promise(e=>{let t=()=>{window.map&&window.markers&&0<window.markers.length?e():setTimeout(t,500)};t()}),window.map.setCenter({lat:t,lng:e}),window.map.setZoom(10)}async function a(r){var e,t,o;document.querySelectorAll(".location_hero_item");r=r.trim().toLowerCase();let a=new google.maps.LatLngBounds,n=!1,i=window.markers.filter(e=>{var{name:e,city:t,state:o,country:a,postcodes:n,stateISO:i}=e.extraData;return(e+` ${t} ${o} ${a} ${n} `+i).toLowerCase().includes(r)});0<i.length?(i.forEach(e=>{e.setMap(window.map),a.extend(e.getPosition())}),n=!0):(console.warn(`❌ No exact match for "${r}". Querying Google...`),(e=await(async a=>{try{return await l(),new Promise((o,e)=>{(new google.maps.Geocoder).geocode({address:a},(e,t)=>{"OK"===t&&0<e.length?(t=e[0].geometry.location,console.log(`✅ Found lat/lng for "${a}":`,t),o({lat:t.lat(),lng:t.lng()})):(console.error(`❌ No results for "${a}".`),o(null))})})}catch(e){return console.error("❌ Error in getLatLngFromSearch:",e),null}})(r))&&((i=(t=e.lat,o=e.lng,window.markers.forEach(e=>{e.extraData.distance=d(t,o,e.getPosition().lat(),e.getPosition().lng())}),window.markers.filter(e=>null!==e.extraData.distance&&!isNaN(e.extraData.distance)).sort((e,t)=>e.extraData.distance-t.extraData.distance).slice(0,3))).forEach(e=>{e.setMap(window.map),a.extend(e.getPosition())}),n=!0)),window.markers.forEach(e=>{i.includes(e)||e.setMap(null)}),g(i),n&&(window.map.fitBounds(a),1===i.length)&&window.map.setZoom(14)}document.querySelectorAll(".locations_nest").forEach(e=>{e.style.display="none"}),e.forEach(t=>{for(let e=0;e<10;e++){var o=document.createElement("div");o.classList.add("n4-locations_loading-skeleton"),t.appendChild(o)}}),window.updateMarkersList=m,window.updateLocationList=g,document.getElementById("get_location_btn").addEventListener("click",async()=>{s(),await c(!0)}),document.getElementById("geo-address").addEventListener("input",function(){a(this.value),s()});let n=document.getElementById("country");e=document.getElementById("area");function i(){console.log("Checking for empty countries..."),document.querySelectorAll(".location_block_item_wrap").forEach(e=>{var t=e.querySelector("[fs-cmsnest-collection='location']");t&&0!==t.children.length?e.style.display="block":e.style.display="none"})}n&&n.addEventListener("change",function(){let a=n.value;var e=document.querySelectorAll("#w-dropdown-list-5 .filters_dropdown_list_item");document.querySelectorAll(".location_block_item_wrap").forEach(e=>{var t=e.getAttribute("n4-filter-country");e.style.display=""===a||a===t?"block":"none"}),e.forEach((e,t)=>{var o=e.getAttribute("n4-filter-state-country");0!==t&&a&&""!==a?e.style.display=o===a?"block":"none":e.style.display="block"})}),e&&e.addEventListener("change",function(){setTimeout(i,200)}),(async()=>{0<window.locationData.length?(console.log("✅ Location data available, initializing map..."),await t(),await o()):(console.log("⏳ Waiting for location data before initializing map..."),window.addEventListener("locationDataLoaded",async()=>{console.log("📍 locationData is now loaded, initializing map..."),await t(),await o()},{once:!0}))})(),o()});