document.addEventListener("DOMContentLoaded",function(){async function a(e=!1){if(!navigator.geolocation)return r("❌ Geolocation is not supported by your browser."),null;try{var t=await navigator.permissions.query({name:"geolocation"});return"denied"===t.state?(console.warn("❌ Geolocation access denied."),alert("Location access is blocked. Please enable it in your browser settings."),null):"prompt"!==t.state||e?new Promise((i,e)=>{navigator.geolocation.getCurrentPosition(async e=>{var t=e.coords.latitude,e=e.coords.longitude;console.log("📍 User's Location:",t,e),s();try{var o,a,n=await(async(e,t)=>{try{return(await(async()=>{if(!window.google||!google.maps||!google.maps.Geocoder)return new Promise((e,t)=>{if(window.google&&google.maps&&google.maps.Geocoder)return e();var o=document.createElement("script");o.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-y5SThmDqWvwCQgQ95LF8tsGHV68TJwk&libraries=places",o.async=!0,o.defer=!0,o.onload=()=>{console.log("✅ Google Maps API Loaded"),e()},o.onerror=()=>t(new Error("❌ Google Maps API failed to load")),document.head.appendChild(o)})})(),google.maps.Geocoder)?new Promise((o,a)=>{(new google.maps.Geocoder).geocode({location:{lat:e,lng:t}},(e,t)=>{"OK"===t&&0<e.length?(e=e[0].formatted_address,console.log("✅ Address from Coordinates:",e),o(e)):(console.error("❌ No address found or geocoding failed:",t),a("Unable to retrieve address."))})}):(console.error("❌ Google Maps Geocoder is not available."),null)}catch(e){return console.error("❌ Error in getAddressFromCoordinates:",e),null}})(t,e);n?(o=document.getElementById("geo-address"))&&(o.value=n,o.dataset.lat=t,o.dataset.lng=e):r("❌ Unable to retrieve address from your location."),window.map&&(console.log("📌 Fitting map to user location"),a=new google.maps.LatLng(t,e),window.map.setCenter(a),window.map.setZoom(10)),window.userLocation={lat:t,lng:e},window.updateMarkersList(),i({lat:t,lng:e})}catch(e){console.error("❌ Error fetching address:",e),r("❌ Unable to retrieve address from your location."),i(null)}},e=>{console.error("❌ Geolocation error:",e),r("❌ Unable to get your location. Please enable location services."),i(null)})}):(console.log("⏳ Waiting for user to interact before requesting location."),null)}catch(e){return console.error("❌ Error checking geolocation permission:",e),null}}function r(e){var t=document.getElementById("address-error");t&&(t.textContent=e,t.style.display="block")}function s(){var e=document.getElementById("address-error");e&&(e.style.display="none",e.textContent="")}function m(e,t,o,a){var n=(o-e)*(Math.PI/180),a=Math.PI/180*(a-t),t=Math.sin(n/2)*Math.sin(n/2)+Math.cos(e*(Math.PI/180))*Math.cos(o*(Math.PI/180))*Math.sin(a/2)*Math.sin(a/2);return(6371*(2*Math.atan2(Math.sqrt(t),Math.sqrt(1-t)))).toFixed(1)}function c(){if(window.map&&window.markers){var e,o=document.getElementById("map_result_count"),c=document.querySelector(".location_hero_list");let t=map.getBounds();t&&(e=markers.filter(e=>t.contains(e.getPosition())),c.innerHTML="",0<e.length?(e.forEach(e=>{var t,o,a,n,i,r,s,l,d;e.extraData?({name:t,link:o,imageUrl:a,distance:n,country:i,state:r,city:s,postcodes:l}=e.extraData,(d=document.createElement("div")).classList.add("location_hero_item"),d.setAttribute("n4-filter-name",t?t.toLowerCase():""),d.setAttribute("n4-filter-city",s?s.toLowerCase():""),d.setAttribute("n4-filter-state",r?r.toLowerCase():""),d.setAttribute("n4-filter-country",i?i.toLowerCase():""),d.setAttribute("n4-filter-postcodes",l?l.toLowerCase():""),d.innerHTML=`
          <div class="location_hero_item_image_wrap">
            <img src="${a}" loading="lazy" alt="${t}" class="location_hero_item_image">
          </div>
          <div class="location_hero_item_content">
            <h4 class="location_hero_item_heading u-text-style-large">${t}</h4>
            ${n?`<p class="u-text-style-small">${n} km away</p>`:""}
            <a href="${o}" class="learnmore_wrap is-underline w-inline-block">
              <div class="learnmore_text u-text-style-main">See location</div>
              <div class="learnmore_underline"></div>
              <div class="learnmore_icon w-embed">
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                  <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                  <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                </svg>
              </div>
            </a>
          </div>
        `,c.appendChild(d)):console.warn("❌ Missing extraData for marker:",e)}),o.textContent=`Showing ${e.length} Locations`):window.userLocation?(console.warn("❌ No visible markers. Displaying the closest 3 locations."),window.markers.forEach(e=>{e.extraData.distance=m(window.userLocation.lat,window.userLocation.lng,e.getPosition().lat(),e.getPosition().lng())}),0<(e=window.markers.filter(e=>null!==e.extraData.distance&&!isNaN(e.extraData.distance)).sort((e,t)=>e.extraData.distance-t.extraData.distance).slice(0,3)).length?(e.forEach((e,t)=>{var{name:e,link:o,imageUrl:a,distance:n}=e.extraData,i=document.createElement("div");i.classList.add("location_hero_item"),i.innerHTML=`
            <div class="location_hero_item_image_wrap">
              <img src="${a}" loading="lazy" alt="${e}" class="location_hero_item_image">
            </div>
            <div class="location_hero_item_content">
              <h4 class="location_hero_item_heading u-text-style-large">${e}</h4>
              <p class="u-text-style-small">${n} km away</p>
              <a href="${o}" class="learnmore_wrap is-underline w-inline-block">
                <div class="learnmore_text u-text-style-main">See location</div>
                <div class="learnmore_underline"></div>
                <div class="learnmore_icon w-embed">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                    <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                    <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                  </svg>
                </div>
              </a>
            </div>
          `,c.appendChild(i)}),o.textContent="Showing Closest Locations to your current location."):o.textContent="No locations found in this area."):(console.warn("❌ No locations available in this area."),o.textContent="No locations found in this area."))}}window.userLocation=null,window.updateMarkersList=c,document.getElementById("get_location_btn").addEventListener("click",async()=>{s(),await a(!0)}),document.getElementById("geo-address").addEventListener("input",function(){{var l=this.value,e=document.querySelectorAll(".location_hero_item");l=l.trim().toLowerCase();let r=new google.maps.LatLngBounds,s=!1;window.markers.forEach(e=>{var{name:t,city:o,state:a,country:n,postcodes:i}=e.extraData;(t+` ${o} ${a} ${n} `+i).toLowerCase().includes(l)?(e.setMap(window.map),r.extend(e.getPosition()),s=!0):e.setMap(null)}),e.forEach(e=>{var t=e.getAttribute("n4-filter-name")||"",o=e.getAttribute("n4-filter-city")||"",a=e.getAttribute("n4-filter-state")||"",n=e.getAttribute("n4-filter-country")||"",e=e.getAttribute("n4-filter-postcodes")||"";t.includes(l)||o.includes(l)||a.includes(l)||n.includes(l)||e.split(", ").some(e=>e.startsWith(l))}),e=document.querySelectorAll(".location_hero_item:not([style*='display: none'])").length,document.getElementById("map_result_count").textContent=`Showing ${e} Locations`,s&&(window.map.fitBounds(r),1===e)&&window.map.setZoom(14)}s()}),(async(e="map_canvas")=>{let{}=await google.maps.importLibrary("maps"),t=document.getElementById(e),n=await a(),o={mapTypeId:"roadmap",zoom:12,gestureHandling:window.innerWidth<=425?"greedy":"auto",styles:[{featureType:"administrative",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"administrative.province",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-100},{lightness:"50"},{visibility:"simplified"}]},{featureType:"road",elementType:"all",stylers:[{saturation:"-100"}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]},{featureType:"water",elementType:"labels",stylers:[{lightness:-25},{saturation:-100}]}],disableDefaultUI:!0,zoomControl:!0,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!0,rotateControl:!1,scaleControl:!1};console.log("Initializing the map:",e);var s=new google.maps.Map(t,o);window.map=s;let i={url:"https://cdn.prod.website-files.com/67ab6f4970b90367b528f15a/67c8f176df8419775322fa3d_NND-marker.svg",scaledSize:new google.maps.Size(50,65),anchor:new google.maps.Point(25,60)},r=[],l=new google.maps.LatLngBounds,d=new google.maps.InfoWindow;return locationData.forEach(e=>{let t=e.imageUrl&&""!==e.imageUrl.trim()?e.imageUrl:"https://cdn.prod.website-files.com/67ab6f4970b90367b528f15a/67aecfc6a895ff8fabea7a46_Staffing%20Support.webp",o=null,a=(n&&(o=m(n.lat,n.lng,e.lat,e.lng)),new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:s,icon:i}));a.extraData={name:e.name,link:e.link,imageUrl:t,distance:o,country:e.country,state:e.state,city:e.city,postcodes:e.postcodes||""},a.addListener("click",()=>{d.setContent(`
          <div style="max-width: 250px;">
            <div class="u-vflex-stretch-center u-gap-3">
              <div style="overflow: hidden; border-radius: .75rem;">
                <img style="max-height: 8rem; aspect-ratio: 16 / 9; object-position: 0% 50%;" src="${t}" alt="${e.name}">
              </div>
                <div>
                  <h4 class="location_hero_item_heading u-text-style-large">${e.name}</h4>
                  <p class="u-text-style-tiny">${e.city}, ${e.state}, ${e.country}</p>
                </div>
              ${o?`<p style="margin: 5px 0; font-size: 14px;"><strong>${o} km away</strong></p>`:""}
              <a href="${e.link}" class="learnmore_wrap is-underline w-inline-block">
                <div class="learnmore_text u-text-style-main">See location</div>
                <div class="learnmore_underline"></div>
                <div class="learnmore_icon w-embed">
                  <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 18 19" fill="none" preserveAspectRatio="xMidYMid meet" aria-hidden="true" role="img">
                    <rect y="0.5" width="18" height="18" rx="9" fill="#EC008C"></rect>
                    <path d="M10.5644 9.11433L8.55285 7.04545L9.08317 6.5L12 9.50002L9.08317 12.5L8.55285 11.9545L10.5644 9.88572H6V9.11433H10.5644Z" fill="white"></path>
                  </svg>
                </div>
              </a>
            </div>
          </div>
        `),d.open(s,a)}),r.push(a),l.extend(a.getPosition())}),window.markers=r,console.log("Markers added successfully."),n?(console.log("✅ Centering on user location:",n),s.setCenter(n),s.setZoom(10)):0<r.length&&s.fitBounds(l),s.addListener("bounds_changed",c),setTimeout(c,1e3),new markerClusterer.MarkerClusterer({map:s,markers:r,renderer:{render:function({count:e,position:t}){var o=10*Math.floor(e/10),o=Math.min(40+o,80),a=o/2,n=a,i=a+.1*o,r=Math.floor(o/3),a={url:"data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`
        <svg width="${o}" height="${o}" xmlns="http://www.w3.org/2000/svg">
          <circle cx="${a}" cy="${a}" r="${a}" fill="#EC008C" />
          <text x="${n}" y="${i}" text-anchor="middle" fill="#fff" font-size="${r}" font-family="Arial" font-weight="bold">${e}</text>
        </svg>
        `),scaledSize:new google.maps.Size(o,o)};return new google.maps.Marker({map:s,position:t,icon:a})}},zoomOnClick:!1,onClusterClick:(e,t)=>{s.fitBounds(t.bounds),s.setZoom(10)}}),s})().then(()=>{(async()=>{var e=new URLSearchParams(window.location.search),t=parseFloat(e.get("lat")),e=parseFloat(e.get("lng"));if(isNaN(t)||isNaN(e)||!window.map){if(window.map&&window.markers){let t=new google.maps.LatLngBounds;window.markers.forEach(e=>t.extend(e.getPosition())),window.map.fitBounds(t)}}else console.log("Centering map from URL parameters:",t,e),window.map.setCenter({lat:t,lng:e}),window.map.setZoom(10)})()})});